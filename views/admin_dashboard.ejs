<!-- views/admin_dashboard.ejs -->

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Админ-панель - Управление товарами</title>
    <link rel="stylesheet" href="/css/common.css">
    <link rel="stylesheet" href="/css/admin.css">
</head>
<body>
    <header>
        <nav>
            <div class="logo">
                <!-- Логотип -->
                <a href="/index.html">
                    <p>LED System Media</p>
                </a>
            </div>
            <div class="nav-links">
                <a href="/index.html">КОМПАНИЯ</a>
                <a href="/catalog.html">ТОВАРЫ</a>
                <a href="/requisites.html">КОНТАКТЫ</a>
                <a href="/admin">АДМИН-ПАНЕЛЬ</a>
                <a href="/admin/logout">ВЫЙТИ</a>
            </div>
            <div class="telephone header-telephone">
                <div class="telephone-numbers">
                    <p class="primary-number">+7 705 371 02 50</p>
                    <p class="secondary-number">+7 705 444 77 03</p>
                </div>
                <span class="arrow">&#9660;</span> <!-- Стрелка вниз -->
            </div>
        </nav>
    </header>
    <main>
        <div class="admin-dashboard">

            <!-- Всплывающие уведомления -->
            <% if (success_msg && success_msg.length > 0) { %>
                <div class="toast success">
                    <%= success_msg %>
                </div>
            <% } %>

            <% if (error_msg && error_msg.length > 0) { %>
                <div class="toast error">
                    <%= error_msg %>
                </div>
            <% } %>

            <a href="/admin/products/add" class="add-button">Добавить новый товар</a>

            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Название</th>
                        <th>Цена (₸)</th>
                        <th>Действия</th>
                    </tr>
                </thead>
                <tbody>
                    <% products.forEach(product => { %>
                        <tr>
                            <td><%= product.id %></td>
                            <td><%= product.name %></td>
                            <td><%= Number(product.price) %></td>
                            <td>
                                <a href="/admin/products/edit/<%= product.id %>" class="edit-button">Редактировать</a>
                                <form action="/admin/products/delete/<%= product.id %>" method="POST" style="display:inline;">
                                    <!-- Добавляем CSRF-токен -->
                                    <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                                    <button type="submit" class="delete-button" onclick="return confirm('Вы уверены, что хотите удалить этот товар?');">Удалить</button>
                                </form>
                            </td>
                        </tr>
                    <% }) %>
                </tbody>
            </table>
        </div>
    </main>
    <footer>
        <p id="license">&copy; 2024 ТОО «LED System Media»</p>
        <div class="nav-links">
            <a href="/index.html">КОМПАНИЯ</a>
            <a href="/catalog.html">ТОВАРЫ</a>
            <a href="/requisites.html">КОНТАКТЫ</a>
        </div>
        <div class="telephone footer-telephone">
            <div class="telephone-numbers">
                <p class="primary-number">+7 705 371 02 50</p>
                <p class="secondary-number">+7 705 444 77 03</p>
            </div>
            <span class="arrow">&#9650;</span> <!-- Стрелка вверх -->
        </div>
    </footer>

    <!-- Всплывающие уведомления -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const toasts = document.querySelectorAll('.toast');
            toasts.forEach(toast => {
                if (toast) {
                    // Показать уведомление
                    toast.classList.add('show');

                    // Скрыть уведомление через 3 секунды
                    setTimeout(() => {
                        toast.classList.remove('show');
                    }, 3000);
                }
            });
        });
    </script>
</body>
</html>
